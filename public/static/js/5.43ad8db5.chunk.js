(this["webpackJsonperp-dashboard"]=this["webpackJsonperp-dashboard"]||[]).push([[5],{392:function(e,t,r){"use strict";r.r(t);var n=r(105),a=r(17),u=r(32),c=r.n(u),s=r(49),o=r(7),i=r(12),l=r(0),p=r(16),d=r(22),f=r(26),b=r(86),h=r(320),m=r(85),j=r(331),g=r(261),x=r(452),y=r(332),O=r(282),_=r(251),k=r(314),v=r(340),w=r(341),S=r(342),F=r(315),R=r(380),C=r(325),P=r(326),q=r(1);var A=function(e){var t=e.folderArr,r=e.currentFolder,n=e.addFolder,a=e.setCurrentFolder,u=e.folderRefresh,o=e.langPack,p=Object(l.useState)(!1),d=Object(i.a)(p,2),f=d[0],b=d[1],h=Object(l.useState)(!1),A=Object(i.a)(h,2),N=A[0],I=A[1];function D(){return(D=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}return e.abrupt("return",queryResult(!1,o.folder.needFolderName));case 2:return e.next=4,n({group_name:f});case 4:return e.sent&&(a(""),E()),e.abrupt("return");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){b(""),I(!1)}return Object(q.jsx)("div",{style:{marginBottom:"20px"},children:N?Object(q.jsx)(q.Fragment,{children:"add"===N?Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(_.a,{sx:{height:"30px",marginRight:"10px"},variant:"outlined",color:"secondary",type:"text",placeholder:o.folder.addNewFolder,onChange:function(e){return b(e.target.value.trim())}}),Object(q.jsx)(O.a,{startIcon:Object(q.jsx)(C.a,{}),onClick:function(){return D.apply(this,arguments)},children:o.common.yes}),Object(q.jsx)(O.a,{startIcon:Object(q.jsx)(P.a,{}),onClick:function(){return I(!1)},children:o.common.no})]}):""}):Object(q.jsx)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:Object(q.jsxs)("span",{children:[t&&t.length?Object(q.jsxs)(j.a,{"aria-label":"breadcrumb",sx:{display:"inline-block",marginRight:"5px"},children:[Object(q.jsx)(k.a,{}),Object(q.jsxs)(g.a,{sx:{height:"30px",minWidth:"100px"},autoWidth:!0,value:r,onChange:function(e){return a(e.target.value)},children:[Object(q.jsx)(x.a,{value:o.folder.currentFolder,disabled:!0,children:o.folder.currentFolder}),t.map((function(e,t){return Object(q.jsx)(x.a,{value:e.group_id,children:e.group_name},t)}))]})]}):Object(q.jsx)(m.a,{variant:"body2",sx:{display:"inline"},children:o.folder.folderNull}),Object(q.jsxs)(y.a,{variant:"",children:[Object(q.jsx)(O.a,{onClick:function(){return I("add")},children:Object(q.jsx)(v.a,{})}),Object(q.jsx)(O.a,{onClick:function(){return I("edit")},disabled:!0,children:Object(q.jsx)(w.a,{})}),Object(q.jsx)(O.a,{onClick:function(){return I("delete")},disabled:!0,children:Object(q.jsx)(S.a,{})}),Object(q.jsx)(O.a,{onClick:function(){return I("upload")},disabled:!0,children:Object(q.jsx)(F.a,{})}),Object(q.jsx)(O.a,{onClick:u,children:Object(q.jsx)(R.a,{})})]})]})})})},N=r(363),I=[];t.default=function(e){var t=e.onProductSelected;console.log("product app running");var r=Object(d.b)(),u=Object(p.f)(),m=Object(d.c)((function(e){return e.globalization})),j=Object(d.c)((function(e){return e.localization})),g=Object(l.useState)(h.a[j.locale]),x=Object(i.a)(g,2),y=x[0],O=x[1],_=Object(l.useState)(m.baseData.loginData),k=Object(i.a)(_,1)[0],v=Object(l.useState)(m.appData),w=Object(i.a)(v,2),S=w[0],F=w[1],R=[],C=Object(l.useState)([]),P=Object(i.a)(C,2),D=P[0],E=P[1],z=Object(l.useState)(y.folder.currentFolder),Q=Object(i.a)(z,2),L=Q[0],U=Q[1],M=Object(l.useState)(0),T=Object(i.a)(M,2),G=T[0],W=T[1],J=Object(l.useState)(10),H=Object(i.a)(J,2),V=H[0],B=H[1],$=Object(l.useState)(0),K=Object(i.a)($,2),X=K[0],Y=K[1],Z=Object(l.useState)([]),ee=Object(i.a)(Z,2),te=ee[0],re=ee[1],ne=Object(l.useState)([]),ae=Object(i.a)(ne,2),ue=ae[0],ce=ae[1],se=Object(l.useState)({}),oe=Object(i.a)(se,2),ie=oe[0],le=oe[1],pe=Object(l.useState)(100),de=Object(i.a)(pe,2),fe=de[0],be=de[1],he=Object(l.useState)(!1),me=Object(i.a)(he,2),je=me[0],ge=me[1];function xe(){return(xe=Object(s.a)(c.a.mark((function e(t){var r,n,u,s,o,i,l,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ma.productGroupAddQuery(t),e.next=3,fetchAPI(r);case 3:if((n=e.sent)&&n.response.status){e.next=6;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+n?n.response.result:""));case 6:if(u=ma.productGroupAddCheck(n),s=u.response,o=s.status,i=s.result,o){e.next=10;break}return e.abrupt("return",queryResult(o,i));case 10:l=i.group_id,p=i.group_name,E([].concat(Object(a.a)(D),[{group_id:l,group_name:p}]));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e,t){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(s.a)(c.a.mark((function e(t,r){var n,a,u,s,o,i,l,p,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ma.productGroupQuery(t),e.next=3,fetchAPI(n);case 3:if((a=e.sent)&&a.response.status){e.next=6;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+a?a.response.result:""));case 6:if(u=ma.productGroupCheck(a),s=u.response,o=s.status,i=s.result,o){e.next=10;break}return e.abrupt("return",queryResult(!1,i));case 10:if(t){e.next=18;break}if(R=[],(l=i.children_id_list.number)&&l.length){e.next=15;break}return e.abrupt("return");case 15:l.forEach((function(e){return ye({group_id:e},l.length)})),e.next=21;break;case 18:p=i.group_id,d=i.group_name,R.push({group_id:p,group_name:d}),R.length===r&&E(R);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(){return(_e=Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L||L===y.folder.currentFolder){e.next=5;break}return t="/product/draft/group_id="+L,e.abrupt("return",u(t));case 5:return e.abrupt("return",queryResult(!1,y.folder.folderRequired));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(l.useEffect)((function(){r({type:f.b,appData:S})}),[r,S]),Object(l.useEffect)((function(){return D.length&&ue.length&&F(Object(o.a)(Object(o.a)({},m.appData),{},{appProduct:{folderArr:D,tableRows:ue,total:X,currentFolder:L}})),function(){}}),[D,ue]),Object(l.useEffect)((function(){L&&L!==y.folder.currentFolder&&(Re(),W(0),Le())}),[L]),Object(l.useEffect)((function(){O(h.a[j.locale])}),[j.locale]),Object(l.useEffect)((function(){return ue.length&&je?I.realLength||function(){qe.apply(this,arguments)}():Le(),function(){return console.log("no need to check the scores")}}),[ue,je]),Object(l.useEffect)((function(){return console.log("I want products"),k?(function(){var e=m.appData.appProduct;e?(e.folderArr&&e.folderArr.length?E(e.folderArr):ye(),e.tableRows&&e.tableRows.length?ce(e.tableRows):Re(),e.total&&Y(e.total),U(e.currentFolder)):(ye(),Re())}(),Le(),function(){console.log("I leave products")}):u("/")}),[]);var ke=function(){var e=Object(s.a)(c.a.mark((function e(t){var r,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("duplicating..."),r=t.id,n=t.category_id,e.next=4,ve({product_id:r});case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",console.log("product schema error"));case 7:return e.next=9,Se(a,n,"duplicate");case 9:return e.abrupt("return",setTimeout(Re,2e3));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function ve(e){return we.apply(this,arguments)}function we(){return(we=Object(s.a)(c.a.mark((function e(t){var r,n,a,u,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ma.productSchemaRenderQuery({param_product_top_publish_request:JSON.stringify(Object(o.a)(Object(o.a)({},t),{},{language:"enUS"===j.locale?"en_US":"zh"}))}),e.next=3,fetchAPI(r);case 3:if((n=e.sent)&&n.response.status){e.next=6;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+n?n.response.result:""));case 6:if(a=ma.productSchemaRenderCheck(n),u=a.response,s=u.status,i=u.result,s){e.next=10;break}return e.abrupt("return",queryResult(s,i));case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e,t,r,n,a){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(s.a)(c.a.mark((function e(t,r,n,a,u){var s,o,i,l,p,d,f,b,h,m,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"add"===n?(s=ma.productSchemaAddQuery,o=ma.productSchemaAddCheck):(s=ma.productSchemaUpdateQuery,o=ma.productSchemaUpdateCheck,i=a),l=(new DOMParser).parseFromString(t,"text/xml"),u&&(l.children[0].querySelector("field#productDescType").remove(),l.children[0].querySelector("field#superText").remove()),Array.from(l.querySelectorAll("itemSchema > field > rules, options, label-group, fields")).forEach((function(e){return e.remove()})),Array.from(l.children[0].children).forEach((function(e){return e.children.length?"":e.remove()})),t=l.children[0].outerHTML,u&&(t=t.replace(/<\/itemSchema>$/,"")+u+"</itemSchema>"),t=t.encodeNonASCII(),p={xml:t,cat_id:Number(r),language:"enUS"===j.locale?"en_US":"zh"},i&&(p.product_id=i),d=s({param_product_top_publish_request:JSON.stringify(p)}),e.next=13,fetchAPI(d);case 13:if((f=e.sent)&&f.response.status){e.next=16;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+f?f.response.result:""));case 16:if(b=o(f),h=b.response,m=h.status,g=h.result,m){e.next=20;break}return e.abrupt("return",queryResult(m,g));case 20:return queryResult(!0,"add"===n?y.steps.addSuccess:"duplicate"===n?y.steps.duplicateSuccess:y.steps.updateSuccess),e.abrupt("return",g);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(s.a)(c.a.mark((function e(t){var r,n,a,u,s,i,l,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be(0),I=[],t||(t={}),L&&L!==y.folder.currentFolder&&(t.group_id1=L),r=ma.productListQuery(t),e.next=7,fetchAPI(r);case 7:if(n=e.sent,be(100),n&&n.response.status){e.next=11;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+n?n.response.result:""));case 11:if(a=ma.productListCheck(n),u=a.response,s=u.status,i=u.result,s){e.next=15;break}return e.abrupt("return",queryResult(!1,i));case 15:if(te.find((function(e){return"final_score"===e.field}))&&Le(),!i.products){e.next=24;break}if((l=i.products.alibaba_product_brief_response)&&l.length){e.next=20;break}return e.abrupt("return");case 20:return p=l.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{keywords:e.keywords?e.keywords.string.toString():"",images:e.main_image?e.main_image.images.string.toString():""})})),ce(p),Y(i.total_item),e.abrupt("return");case 24:return ce([]),Y(0),e.abrupt("return");case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(){return(Pe=Object(s.a)(c.a.mark((function e(t){var r,n,a,u,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return r=ma.productDisplayQuery(t),e.next=5,fetchAPI(r);case 5:if((n=e.sent)&&n.response.status){e.next=8;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+n?n.response.result:""));case 8:if(a=ma.productDisplayCheck(n),u=a.response,s=u.status,o=u.result,s){e.next=12;break}return e.abrupt("return",queryResult(!1,o));case 12:return setTimeout(Re,2e3),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(){return(qe=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ue.length){e.next=2;break}return e.abrupt("return");case 2:return be(0),I.realLength=0,ue.forEach((function(e){console.log("checking scores"),Ae({product_id:e.product_id})})),e.abrupt("return");case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(s.a)(c.a.mark((function e(t){var r,n,a,u,s,i,l,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ma.productScoreQuery(t),e.next=3,fetchAPI(r);case 3:if(n=e.sent,a=ma.productScoreCheck(n),u=a.request.data.product_id,s=ue.findIndex((function(e){return e.product_id===u})),-1!==s){e.next=10;break}return be(100),e.abrupt("return");case 10:if(i=a.response,l=i.status,p=i.result,l?("zhCN"===j.locale?p.tag=p.tagCn:p.tag=p.tagEn,I[s]=p):(I[s]={},queryResult(!1,y.steps.productScoreError)),I.realLength++,I.realLength&&be(I.realLength/ue.length*100),I.realLength===ue.length){e.next=16;break}return e.abrupt("return");case 16:return be(100),ce((function(e){for(var t=[],r=0;r<e.length;r++)t.push(Object(o.a)(Object(o.a)({},e[r]),I[r]));return t})),Le({score:!0}),e.abrupt("return");case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(){return(Ie=Object(s.a)(c.a.mark((function e(t){var r,a,u,s,o,i,l,p,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length){e.next=2;break}return e.abrupt("return");case 2:r=Object(n.a)(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=15;break}if(u=a.value){e.next=9;break}return e.abrupt("continue",13);case 9:return s=u.category_id,o=u.keywords,i=u.product_type,l=u.subject,p=u.product_id,d={category_id:s,keywords:o,product_type:i,subject:l,product_id:p},e.next=13,De(d);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return setTimeout((function(){Re({current_page:G+1,page_size:V})}),2e3),e.abrupt("return");case 25:case"end":return e.stop()}}),e,null,[[3,17,20,23]])})))).apply(this,arguments)}function De(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(s.a)(c.a.mark((function e(t){var r,n,a,u,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ma.productFieldUpdateQuery(t),e.next=3,fetchAPI(r);case 3:if((n=e.sent)&&n.response.status){e.next=6;break}return e.abrupt("return",queryResult(!1,y.common.netFail+"\n"+n?n.response.result:""));case 6:return a=ma.productFieldUpdateCheck(n),u=a.response,s=u.status,o=u.result,queryResult(s,o),console.log(o),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Re({current_page:G+1,page_size:V});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Qe={scoreAutoQuery:je,setScoreAutoQuery:ge,addProduct:function(){return _e.apply(this,arguments)},updateProduct:function(e){return Ie.apply(this,arguments)},changeProductDisplay:function(e){return Pe.apply(this,arguments)},duplicateProduct:ke};function Le(e){var t=[{field:"imgWithURL",headerName:y.table.tableHeader,minWidth:50,valueGetter:function(e){return e.row},valueFormatter:function(e){return e.value.pc_detail_url},renderCell:function(e){var t=e.value;return Object(q.jsx)("a",{href:t.pc_detail_url,target:"_blank",children:Object(q.jsx)("img",Object(o.a)(Object(o.a)({},srcset(t.images.split(",")[0],100,100,1,1)),{},{style:{width:"93%"},alt:"mainPic"}))})}},{field:"id",headerName:y.table.id},{field:"subject",editable:!0,minWidth:300,headerName:y.table.subject},{field:"keywords",editable:!0,flex:1,headerName:y.table.keywords,preProcessEditCellProps:function(e){var t=e.props.value;if(t){var r=t.split(",");if(r.length>3){r.length=3,queryResult(!1,y.form.keywords);var n=r.join(",");return Object(o.a)(Object(o.a)({},e.props),{},{keywords:n,error:!0})}}return e.props}},{field:"status",flex:.5,headerName:y.table.status},{field:"display",flex:.5,headerName:y.table.display},{field:"is_rts",flex:.5,headerName:y.table.is_rts},{field:"is_specific",flex:.5,headerName:y.table.is_specific},{field:"owner_member_display_name",flex:.5,headerName:y.table.owner_member_display_name},{field:"product_type",flex:.5,headerName:y.table.product_type},{field:"smart_edit",flex:.5,headerName:y.table.smart_edit},{field:"gmt_create",flex:.5,valueGetter:function(e){return e.row},valueFormatter:function(e){var t=e.value;return new Date(t.gmt_create).Format("yyyy-MM-dd hh:mm")},headerName:y.table.gmt_create},{field:"gmt_modified",flex:.5,valueGetter:function(e){return e.row},valueFormatter:function(e){var t=e.value;return new Date(t.gmt_modified).Format("yyyy-MM-dd hh:mm")},headerName:y.table.gmt_modified}];e&&(e.score&&t.splice(5,0,{field:"final_score",headerName:y.table.score,flex:.5,sortable:!0},{field:"tag",headerName:y.table.tag,flex:.5,sortable:!0}));re(t),le({id:!1,is_rts:!1,is_specific:!1,owner_member_display_name:!1,product_type:!1,smart_edit:!1})}return Object(q.jsxs)(b.a,{title:"Products --\u4ea7\u54c1",children:[Object(q.jsx)(A,{folderArr:D,currentFolder:L,addFolder:function(e){return xe.apply(this,arguments)},setCurrentFolder:U,folderRefresh:ze,langPack:y}),Object(q.jsx)(N.a,{tableRows:ue,tableColumns:te,page_size:V,page:G,total:X,localization:j,langPack:y,columnVisibilityModel:ie,setColumnVisibilityModel:le,handleChangePage:function(e){W(e),Re({current_page:e+1,page_size:V})},handleChangeRowsPerPage:function(e){B(e),Re({current_page:G+1,page_size:e})},onRowClick:function(e,t){},productTableFn:Qe,onTableSelection:function(e){console.log(e.length+" selected"),void 0!==t&&t(e)},loadingProgress:fe})]})}}}]);
//# sourceMappingURL=5.43ad8db5.chunk.js.map